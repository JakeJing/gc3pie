\documentclass[english,serif,mathserif,xcolor=pdftex,dvipsnames,table]{beamer}
\usetheme{gc3}

\usepackage[T1]{fontenc}
\usepackage[utf8]{inputenc}
\usepackage{babel}

\usepackage{gc3}

\title[Debugging commands]{%
  Useful \\ debugging commands
}
\author[R. Maffioletti, S3IT UZH]{%
  Sergio Maffioletti \texttt{<sergio.maffioletti@uzh.ch>}
  \\[1ex]
  \emph{S3IT: Services and Support for Science IT}
  \\[1ex]
  University of Zurich
}
\date{September~12--13, 2016}

\begin{document}

% title frame
\maketitle


\begin{frame}[fragile]
  \frametitle{List tasks in a session}

  The \texttt{gsession list} command prints the list of tasks in a
  session, together with their state:

\begin{stdout}

$ ^\HL{gsession list -r gasset}^
+--------------+--------------+------------+----------------------------------------+
| JobID        | Job name     | State      | Info                                   |
+--------------+--------------+------------+----------------------------------------+
| GassetApp.71 | GassetApp-N7 | TERMINATED | TERMINATED at Sat Sep 10 22:24:03 2016 |
| GassetApp.73 | GassetApp-N5 | TERMINATED | TERMINATED at Sat Sep 10 22:24:03 2016 |
| GassetApp.72 | GassetApp-N6 | TERMINATED | TERMINATED at Sat Sep 10 22:24:50 2016 |
| GassetApp.75 | GassetApp-N3 | TERMINATED | TERMINATED at Sat Sep 10 22:24:55 2016 |
| GassetApp.74 | GassetApp-N4 | TERMINATED | TERMINATED at Sat Sep 10 22:26:22 2016 |
| GassetApp.77 | GassetApp-N1 | TERMINATED | TERMINATED at Sat Sep 10 22:26:07 2016 |
| GassetApp.76 | GassetApp-N2 | TERMINATED | TERMINATED at Sat Sep 10 22:26:42 2016 |
+--------------+--------------+------------+----------------------------------------+
\end{stdout}%$
\end{frame}


\begin{frame}[fragile]
  \frametitle{Show log of actions in session}

  The \texttt{gession log} command prints out the sequence of actions
  and state changes for all tasks in a session:

\begin{stdout}
$ ^\HL{gsession log gasset}^
Sep 10 22:26:07 GassetApp.76: Submitting to 'localhost'
Sep 10 22:26:07 GassetApp.76: SUBMITTED
Sep 10 22:26:07 GassetApp.76: Submitted to 'localhost'
Sep 10 22:26:07 GassetApp.77: Final output downloaded to 'gasset-1'
Sep 10 22:26:07 GassetApp.77: TERMINATED
Sep 10 22:26:12 GassetApp.76: RUNNING
Sep 10 22:26:22 GassetApp.74: TERMINATING
Sep 10 22:26:22 GassetApp.74: Final output downloaded to 'gasset-4'
Sep 10 22:26:22 GassetApp.74: TERMINATED
Sep 10 22:26:42 GassetApp.76: TERMINATING
Sep 10 22:26:42 GassetApp.76: Final output downloaded to 'gasset-2'
Sep 10 22:26:42 GassetApp.76: TERMINATED
\end{stdout}%$
\end{frame}


\begin{frame}[fragile]
  \frametitle{Dump contents of a task}

  The \texttt{ginfo} command allows you to dump the contents of a
  specific task, or all tasks in a session:

\begin{stdout}[basicstyle=\tiny\ttfamily]
$ ^\HL{ginfo -v -s gasset}^
GassetApp.71
    ^\em [\ldots]^
    arguments: matlab, -nodesktop, -nodisplay, -nosplash, -r, simAsset  58  0.0471155977822  0.263213407081  0.0109589041096  534  3000  7 ;quit()
    inputs: 
        file:///home/ubuntu/gasset/simAsset.m: simAsset.m
    outputs: 
        stderr.txt: file, , stderr.txt, None, None, , None, None
        ./results/: file, , , None, None, , None, None
        stdout.txt: file, , stdout.txt, None, None, , None, None
    requested_memory: 1GB
    jobname: GassetApp-N7
    execution: 
        ^\em [\ldots]^
        _state: TERMINATED
        returncode: 0, 0
        history:
            - Submitting to 'localhost' at Sat Sep 10 22:23:16 2016
            - SUBMITTED at Sat Sep 10 22:23:17 2016
            - Submitted to 'localhost' at Sat Sep 10 22:23:17 2016
            - RUNNING at Sat Sep 10 22:23:22 2016
            - TERMINATING at Sat Sep 10 22:24:03 2016
            - Final output downloaded to 'gasset-7' at Sat Sep 10 22:24:03 2016
            - TERMINATED at Sat Sep 10 22:24:03 2016
\end{stdout}%$
\end{frame}


% \begin{frame}[fragile]
%   \frametitle{Dump contents of a task, II}

%   Note that \textbf{without the \texttt{-v}} option, \texttt{ginfo}
%   limits its output to the \texttt{.execution} attribute of a
%   \texttt{Task}/\texttt{Application} object:

% \begin{stdout}[basicstyle=\tiny\ttfamily]
% $ ^\HL{ginfo -s ex2b}^
% GrayscaleApp.6
%   ^\em [\ldots]^
%   history:
%     - Submitting to 'localhost' at Sun Jul 10 00:27:02 2016
%     ^\em [\ldots]^
%   lrms_execdir: /home/gc3pie/docs/programmers/tutorials/workflows/gc3libs.SMGNxr
%   lrms_jobid: 23183
%   resource_name: localhost
%   ^\em [\ldots]^
% \end{stdout}%$
% \end{frame}


\begin{frame}[fragile]
  \frametitle{Abort all tasks in a session}

  The \texttt{gsession abort} command kills all tasks in a session.
\begin{stdout}
$ ^\HL{gsession abort gasset}^
\end{stdout}%$

  \+
  It produces normally no output; use the \texttt{-v} option to see a
  log of actions taken.

  \+ \small \textbf{Note:} it is important that sessions are
  terminated!  Otherwise, GC3Pie will consider part of the resources
  as still allocated to a task.  This is especially evident when
  running on a single computer: after launching a few tasks, GC3Pie
  will stop and refuse to run anything.
\end{frame}


\begin{frame}[fragile]
  \frametitle{Manual cleanup of the {\ttfamily localhost} resource}

  In case of incomplete cleanup, you will still run into this error:
\begin{stdout}
  ERROR: Resource localhost already running maximum allowed number of jobs
\end{stdout}

  \+
  As a last resort, you can inspect directory \lstinline|$HOME/.gc3/shellcmd.d|:
\begin{stdout}
  $ ls $HOME/.gc3/shellcmd.d
  15843
\end{stdout}
  Each of these files is an allocated execution slot in the \texttt{localhost} resource.
  Delete the files to free up the slot.

  \+ (The file name is the PID of the process, in case you want to
  check if a command is still running before you make GC3Pie forget
  about it.)
\end{frame}


\end{document}

%%% Local Variables:
%%% mode: latex
%%% TeX-master: t
%%% End:
